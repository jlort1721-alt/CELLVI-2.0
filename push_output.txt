Connecting to remote database...
Do you want to push these migrations to the remote database?
 • 20260213130000_fix_vehicles_schema.sql
 • 20260213130000_forensic_ledger.sql

 [Y/n] Applying migration 20260213130000_fix_vehicles_schema.sql...
NOTICE (42701): column "last_location" of relation "vehicles" already exists, skipping
NOTICE (42701): column "last_status" of relation "vehicles" already exists, skipping
ERROR: null value in column "slug" of relation "tenants" violates not-null constraint (SQLSTATE 23502)                                                                                                                                                                                               
Failing row contains (65104673-73a0-443f-8634-e9516724f12c, Demo Tenant, null, basic, {}, {"max_users": 10, "max_vehicles": 50, "events_per_day": 100000, ..., {"satellite": false, "cold_chain": false, "policy_engine": true,..., t, 2026-02-13 05:24:41.946511+00, 2026-02-13 05:24:41.946511+00).
At statement: 1                                                                                                                                                                                                                                                                                      
-- Create an index for faster geospatial queries if needed in future (using GIN on jsonb is one way, or extract to PostGIS)                                                                                                                                                                          
-- For now, just ensuring the columns exist is enough for the frontend.                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                     
-- Insert some dummy data if the table is empty to visualize the map                                                                                                                                                                                                                                 
-- Insert some dummy data if the table is empty to visualize the map                                                                                                                                                                                                                                 
DO $$                                                                                                                                                                                                                                                                                                
DECLARE                                                                                                                                                                                                                                                                                              
    v_tenant_id UUID;                                                                                                                                                                                                                                                                                
BEGIN                                                                                                                                                                                                                                                                                                
    -- Check if a tenant exists                                                                                                                                                                                                                                                                      
    SELECT id INTO v_tenant_id FROM public.tenants LIMIT 1;                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                     
    -- If not, create one                                                                                                                                                                                                                                                                            
    IF v_tenant_id IS NULL THEN                                                                                                                                                                                                                                                                      
        INSERT INTO public.tenants (name) VALUES ('Demo Tenant') RETURNING id INTO v_tenant_id;                                                                                                                                                                                                      
    END IF;                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                     
    -- Insert vehicles using this tenant_id                                                                                                                                                                                                                                                          
    INSERT INTO public.vehicles (tenant_id, plate, last_location, last_status)                                                                                                                                                                                                                       
    SELECT v_tenant_id, 'TEST-001', '{"lat": 4.65, "lng": -74.05, "speed": 45, "heading": 90}', 'moving'                                                                                                                                                                                             
    WHERE NOT EXISTS (SELECT 1 FROM public.vehicles WHERE plate = 'TEST-001');                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                     
    INSERT INTO public.vehicles (tenant_id, plate, last_location, last_status)                                                                                                                                                                                                                       
    SELECT v_tenant_id, 'TEST-002', '{"lat": 4.62, "lng": -74.10, "speed": 0, "heading": 0}', 'stopped'                                                                                                                                                                                              
    WHERE NOT EXISTS (SELECT 1 FROM public.vehicles WHERE plate = 'TEST-002');                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                     
    INSERT INTO public.vehicles (tenant_id, plate, last_location, last_status)                                                                                                                                                                                                                       
    SELECT v_tenant_id, 'TEST-003', '{"lat": 4.70, "lng": -74.08, "speed": 80, "heading": 180}', 'alert'                                                                                                                                                                                             
    WHERE NOT EXISTS (SELECT 1 FROM public.vehicles WHERE plate = 'TEST-003');                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                     
END $$                                                                                                                                                                                                                                                                                               
Try rerunning the command with --debug to troubleshoot the error.
